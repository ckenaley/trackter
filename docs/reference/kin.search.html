<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Midline and outline tracking over image sequences — kin.search • trackter</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Midline and outline tracking over image sequences — kin.search" />
<meta property="og:description" content="Wrapper functions for find.roi that automatically retrieve the contour and midline coordinates of a detected ROI in each image of a sequence through thresholding and segmentation. Also outputs the midline amplitude relative to a reference line determined by an anterior section of the ROI. Supported image formats are jpeg, png, and tiff.

kin.search and kin.simple find the y-value midpoint along the x-value array of the ROI and fits a midline according to a chosen smoothing method (loess or spline). Thus, these assume a horizontal position (see Details).
kin.search and kin.free include arguments for flexible ROI selection.
kin.simple is itself a wrapper for kin.search, finding the largest ROI in field using Otsu thresholding for segmentation.
kin.free does not assume any particular orientation and is intended for finding ROIs freely moving within the image field. This function estimates midlines by various methods and supports parallel processing of frames (see Details)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trackter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/image_analysis.html">Image Analysis</a>
    </li>
    <li>
      <a href="../articles/kinematic_analysis.html">Kinematic Analysis</a>
    </li>
    <li>
      <a href="../articles/startup.html">Starting Up</a>
    </li>
    <li>
      <a href="../articles/visualization.html">Visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Midline and outline tracking over image sequences</h1>
    
    <div class="hidden name"><code>kin.search.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Wrapper functions for <code><a href='find.roi.html'>find.roi</a></code> that automatically retrieve the contour and midline coordinates of a detected ROI in each image of a sequence through thresholding and segmentation. Also outputs the midline amplitude relative to a reference line determined by an anterior section of the ROI. Supported image formats are jpeg, png, and tiff.</p>

<p><code>kin.search</code> and <code>kin.simple</code> find the y-value midpoint along the x-value array of the ROI and fits a midline according to a chosen smoothing method (loess or spline). Thus, these assume a horizontal position (see Details).</p>
<p><code>kin.search</code> and <code>kin.free</code> include arguments for flexible ROI selection.</p>
<p><code>kin.simple</code> is itself a wrapper for <code>kin.search</code>, finding the largest ROI in field using Otsu thresholding for segmentation.</p>
<p><code>kin.free</code> does not assume any particular orientation and is intended for finding ROIs freely moving within the image field. This function estimates midlines by various methods and supports parallel processing of frames (see Details).</p>
    </div>

    <pre class="usage"><span class='fu'>kin.search</span><span class='op'>(</span>
  image.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  frames <span class='op'>=</span> <span class='cn'>NULL</span>,
  ant.per <span class='op'>=</span> <span class='fl'>0.1</span>,
  tips <span class='op'>=</span> <span class='fl'>0.02</span>,
  smooth.n <span class='op'>=</span> <span class='fl'>0</span>,
  ml.meth <span class='op'>=</span> <span class='st'>"hull"</span>,
  ml.smooth <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"loess"</span>, <span class='fl'>0.25</span><span class='op'>)</span>,
  save <span class='op'>=</span> <span class='cn'>FALSE</span>,
  plot.pml <span class='op'>=</span> <span class='cn'>TRUE</span>,
  out.qual <span class='op'>=</span> <span class='fl'>1</span>,
  out.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>kin.simple</span><span class='op'>(</span>
  image.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  frames <span class='op'>=</span> <span class='cn'>NULL</span>,
  ant.per <span class='op'>=</span> <span class='fl'>0.2</span>,
  tips <span class='op'>=</span> <span class='fl'>0.02</span>,
  smooth.n <span class='op'>=</span> <span class='fl'>0</span>,
  ml.meth <span class='op'>=</span> <span class='st'>"hull"</span>,
  ml.smooth <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"loess"</span>, <span class='fl'>0.25</span><span class='op'>)</span>,
  save <span class='op'>=</span> <span class='cn'>FALSE</span>,
  plot.pml <span class='op'>=</span> <span class='cn'>TRUE</span>,
  out.qual <span class='op'>=</span> <span class='fl'>1</span>,
  out.dir <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>kin.free</span><span class='op'>(</span>
  image.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  frames <span class='op'>=</span> <span class='cn'>NULL</span>,
  par <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cores.n <span class='op'>=</span> <span class='cn'>NULL</span>,
  ant.per <span class='op'>=</span> <span class='fl'>0.1</span>,
  ant.pos <span class='op'>=</span> <span class='cn'>NULL</span>,
  tips <span class='op'>=</span> <span class='fl'>0.02</span>,
  smooth.n <span class='op'>=</span> <span class='fl'>1</span>,
  red <span class='op'>=</span> <span class='cn'>NULL</span>,
  ml.meth <span class='op'>=</span> <span class='st'>"hull"</span>,
  ml.smooth <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"spline"</span>, <span class='fl'>0.25</span><span class='op'>)</span>,
  save <span class='op'>=</span> <span class='cn'>FALSE</span>,
  out.qual <span class='op'>=</span> <span class='fl'>1</span>,
  out.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot.pml <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>image.dir</th>
      <td><p>character, directory containing images to analyze.</p></td>
    </tr>
    <tr>
      <th>frames</th>
      <td><p>numeric, vector indicating which images to process. NULL, the default, will result in all images in <code>image.dir</code> processed.</p></td>
    </tr>
    <tr>
      <th>ant.per</th>
      <td><p>numeric; left-most percentage of ROI that establishes the horizontal reference for the midline displacement.</p></td>
    </tr>
    <tr>
      <th>tips, </th>
      <td><p>numeric, the proportion the the midline data to use in calculation of the head and tail position.</p></td>
    </tr>
    <tr>
      <th>smooth.n, </th>
      <td><p>numeric, the number of contour smoothing iterations. See Details.</p></td>
    </tr>
    <tr>
      <th>ml.meth</th>
      <td><p>character, the midline detection method. One of 'ang' for bisection using <code><a href='free.ml.ang.html'>free.ml.ang</a></code>, 'hull' for bisection using <code><a href='free.ml.ang.html'>free.ml.hull</a></code>, or 'del' for Delaunay triangulation using <code><a href='free.ml.ang.html'>free.ml.del</a></code>. See Details</p></td>
    </tr>
    <tr>
      <th>ml.smooth</th>
      <td><p>a list of length two with unnamed components including a character string specifying the midline smoothing method, either 'loess' or "spline", and a numeric value specifying the amount of smoothing. See Details.</p></td>
    </tr>
    <tr>
      <th>save</th>
      <td><p>logical, value indicating if images should be outputted with midline and predicted midline based on the <code>ant.per</code> <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> overlaying original or binary images.</p></td>
    </tr>
    <tr>
      <th>plot.pml</th>
      <td><p>logical, value indicating if outputted images should include an overlay of the theoretical midline based on <code>ant.per</code>.</p></td>
    </tr>
    <tr>
      <th>out.qual, </th>
      <td><p>numeric, a value between 0-1 representing the quality of outputted images. Ignored if <code>save=FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>out.dir</th>
      <td><p>character, the directory to which outputted images should be saved.</p></td>
    </tr>
    <tr>
      <th>..., </th>
      <td><p>other parameters passed to <code>link{find.roi}</code>.</p></td>
    </tr>
    <tr>
      <th>par</th>
      <td><p>logical, should the frames be processed in parallel using <code>cores.n</code>.</p></td>
    </tr>
    <tr>
      <th>cores.n</th>
      <td><p>numeric, the number of CPU cores to use if <code>par=TRUE</code>. If <code>cores.n=NULL</code> (the default), the total number of cores minus 1 are used.</p></td>
    </tr>
    <tr>
      <th>ant.pos</th>
      <td><p>character, one of NULL, "l","r","u",or "d" to specify the position of the anterior of the ROI. If not NULL, the default algorithm to find the anterior is overridden. See Details.</p></td>
    </tr>
    <tr>
      <th>red</th>
      <td><p>numeric, between 0-1 the proportion of contour coordinates to sample for midline estimates. Ignored if <code>ml.meth</code> is not 'del'. Will speed up midline estimations with Delaunay triangulation. If 'NULL', the full contour retrieved from the ROI will be passed to <code><a href='free.ml.ang.html'>free.ml.del</a></code>. See Detail.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with the following components:</p>
<p><code>kin.dat</code> a data table consisting of frame-by-frame position parameters for the ROI determined by <code>search.for</code>.</p><ul>
<li><p>the frame number</p></li>
<li><p>'roi': a character indicating the ROI ranked by size ('a' being the largest)</p></li>
<li><p>'x' and ''y': the position of the tail (rightmost or posteriormost)</p></li>
<li><p>'head.x' and 'head.y': the x and y position of the head (leftmost or anteriormost)</p></li>
<li><p>'amp': the amplitude (<code>amp</code>) of the tail relative to thr theoretical midline determined by the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> predictions from <code>ant.per</code></p></li>
<li><p>'head.pval': p values of the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> fit that describes the position of the head as determined by <code>ant.per</code> (green points in the outputted images/video)</p></li>
</ul>

<p><code>midline</code> A data table containing, for each frame described by <code>frames</code>, the following:</p><ul>
<li><p>the frame number</p></li>
<li><p>'roi': a character indicating ROI size ('a' being the largest)</p></li>
<li><p>'n': the index of the points where n=1 is headmost</p></li>
<li><p>'x' and 'y': unsmoothed x and y positions of the midline of the ROI</p></li>
<li><p>'x.sm' and 'y.sm': midline points fit to a smooth spline or loess model with spar or span equal to <code>smooth</code> (red curve in the outputted images/video)</p></li>
<li><p>'wave.y': midline points 'y.pred' relative to 'mid.pred'</p></li>
<li><p>'per.bl': the percentage of 'x.sm' along the body length calculated as the cumulative sum of distances between points</p></li>
</ul>

<p><code>cont</code> A data table containing x and y positions of the contours used to calculate the data in 'kin.dat'. Contains the following:</p><ul>
<li><p>'frame': the frame</p></li>
<li><p>'x' and 'y': the x and y positions of the contours</p></li>
</ul>

<p><code>cont.sm</code> A data table containing the smoothed x and y positions of the contours used to calculate the data in 'kin.dat'. Contains the following:</p><ul>
<li><p>'frame': the frame</p></li>
<li><p>'n': the position of the coordinate. n=1 and n=max(n) are adjacent at the head</p></li>
<li><p>'x' and 'y': the x and y positions of the contours</p></li>
</ul>

<p><code>all.classes</code> A data table containing the following for all ROIs detected:</p><ul>
<li><p>'frame': the frame</p></li>
<li><p>'roi': the name of each ROI found in a frame.</p></li>
<li><p>'edge': indicating whether ROI was on the edge of the image field</p></li>
<li><p>'size': size of the ROI in pixels^2</p></li>
<li><p>'offset.x': ROI distance from horizontal center</p></li>
<li><p>'offset.y': ROI distance from vertical center</p></li>
<li><p>'offset': linear distance of ROI's centroid to image center</p></li>
</ul>

<p><code>mid.pred</code> the theoretical midline based on a linear model established by the anterior section of the smoothed midline established by <code>ant.per</code>. Used to calculate <code>midline$wave.y</code> as the orthogonal distance between the line defined by 'x' and 'mid.pred' and each coordinate defined by '<code>midline$x.sm</code> and <code>midline$y.sm</code>. A data table that contains the following:</p>
<ul>
<li><p>'frame': the frame</p></li>
<li><p>'x': x position of the predicted midline</p></li>
<li><p>'mid.pred': the y position of the predicted midline</p></li>
</ul>

<p><code>dim</code> the x and y dimensions of the images analyzed</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The algorithms in <code>kin.simple</code> and <code>kin.search</code> assume a left-right horizontal orientation, i.e., the head of the ROI is positioned left, the tail right. If this is not the case, consider using <code>kin.free</code> or rotating images before processing. The <code>ant.per</code> value therefor establishes the reference line (theoretical straight midline) based on that portion of the head. The midline is calculated as the midpoints between the y extrema for each x position.</p>
<p><code>kin.search</code> and <code>kin.free</code> choose ROIs based on relative ROI size or position according to <code><a href='find.roi.html'>find.roi</a></code>. Parameters  for this function are passed through additional arguments with <code>...</code>. Thresholding operations can be performed with an arbitrary (user defined) numeric value or with Otsu's method ('thr="otsu"'). The latter chooses a threshold value by minimizing the combined intra-class variance. See <code>otsu</code>.</p>
<p><code>kin.simple</code> is more streamlined than <code>kin.search</code>. It attempts to find the largest ROI using Otsu thresholding and invokes other default values of <code><a href='find.roi.html'>find.roi</a></code>.</p>

<p>With <code>kin.free</code>, the position of the anterior of the ROI (that which is moving forward in the field) is determined by the displacement of the ROI between the first two frames. Thus, <code>frames</code> must be &gt;1. For analyses of relatively static ROIs in the field (e.g., steadily swimming animals in flumes, etc.), automatically determining the anterior of the ROI may be spurious. In this case, the default automatic determination of the anterior should be overridden by specifying 'l', 'r', 'u', 'd' with <code>ant.pos</code>. These values specify that the anterior region of the ROI is leftmost, rightmost, upmost, or downmost in the field, respectively, and assumes that the origin of the field (0,0) is the upper left corner of each frame.</p>
<p>Midline estimation in <code>kin.free</code> is pursued by one of three algorithms: bisection of contours across the long axis defined by the tips using <code><a href='free.ml.ang.html'>free.ml.ang</a></code> or <code><a href='free.ml.ang.html'>free.ml.hull</a></code>  or by Delaunay triangulation using <code><a href='free.ml.ang.html'>free.ml.del</a></code>. The default is 'hull' This choice is not arbitrary. The use of <code>free.ml.ang</code> and <code>free.ml.hull</code> can be faster, but perform poorly for tips that snake back on themselves (i.e., a high degree curvature). The use of <code>free.ml.del</code> can be slower for high resolution outlines, but  produces better results when contour regions overlap (i.e, those that snake back on themselves), but produces less precise midlines for complicated contours. Using Delaunay triangulation can be hastened (but possibly with a trade off in precision) by reducing the the complexity of the contour with the 'red' argument. For example, a contour of 1000 coordinates would be reduced to one of 500 with 'red=0.5'.</p>
<p>For midline smoothing, if <code>ml.smooth</code> contains 'spline', <code>smooth_spline</code> from the <code>smoothr</code> package is used to interpolate points between a reduced number of vertices using piecewise cubic polynomials. The number of vertices is calculated based on the number of midline coordinates times numeric value of the list in <code>ml.smooth</code>. If <code>ml.smooth</code> contains 'loess', <code>loess</code> is used to fit a polynomial surface. For contours that have a complicated midline with non-unique x values, say an orginisms swimming vertically in the file, loess smoothing can produce poor results. Thus, spline smoothing is usually the advisable option.</p>
<p>For contour smoothing before midline estimate in <code>kin.free</code>, <code>smooth.n</code> is passed to the <code>smooth.n</code> parameter of <code><a href='free.ml.ang.html'>free.ml.ang</a></code>, <code><a href='free.ml.ang.html'>free.ml.hull</a></code>, or <code><a href='free.ml.ang.html'>free.ml.del</a></code>, which smooths coordinates using a simple moving average. Contours are similarly smoothed in <code>kin.search</code> and <code>kin.simple</code> by invoking <code><a href='https://rdrr.io/pkg/Momocs/man/coo_smooth.html'>coo_smooth</a></code> from the <code><a href='https://rdrr.io/pkg/Momocs/man/Momocs.html'>Momocs</a></code> package.  Users should be wary of oversmoothing by smoothing both the contour (from which the midline is calculated) and the midline.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>kin.free</code>, <code><a href='find.roi.html'>find.roi</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#### plot caudal amplitude and produce a classic midline waveform plot of a swimming rainbow trout</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span>
<span class='co'>##A very long example using kin.search()</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>

<span class='co'>#download example images and place in 'example' subdirectory</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='st'>"https://github.com/ckenaley/exampledata/blob/master/example.zip?raw=true"</span>

<span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>f</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/temp.zip"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/unzip.html'>unzip</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/temp.zip"</span><span class='op'>)</span>, exdir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/temp.zip"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/processed_images"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>kin</span> <span class='op'>&lt;-</span> <span class='fu'>kin.search</span><span class='op'>(</span>image.dir <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/example"</span><span class='op'>)</span>,
      frames<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span>,
      out.dir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/processed_images"</span><span class='op'>)</span><span class='op'>)</span>
      

<span class='co'>#plot instantaneous amplitude of tail (last/rightmost point) over frames</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/ggplot.html'>ggplot</a></span><span class='op'>(</span>dat<span class='op'>=</span><span class='va'>kin</span><span class='op'>$</span><span class='va'>kin.dat</span>,<span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>frame</span>,y<span class='op'>=</span><span class='va'>amp</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='fl'>15</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>

<span class='co'># midline plot</span>
<span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='va'>kin</span><span class='op'>$</span><span class='va'>midline</span>

<span class='co'>#leftmost x starts at 0</span>
<span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='va'>ml</span><span class='op'>[</span>,<span class='va'>x2</span><span class='op'>:=</span><span class='va'>x</span><span class='op'>-</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,by<span class='op'>=</span><span class='va'>frame</span><span class='op'>]</span>

<span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>ml</span>,<span class='va'>kin</span><span class='op'>$</span><span class='va'>kin.dat</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>frame</span>,<span class='va'>amp</span><span class='op'>)</span><span class='op'>]</span>,by<span class='op'>=</span><span class='st'>"frame"</span><span class='op'>)</span> <span class='co'>#merge these</span>

<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/ggplot.html'>ggplot</a></span><span class='op'>(</span>dat<span class='op'>=</span><span class='va'>ml</span>,<span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x2</span>,y<span class='op'>=</span><span class='va'>wave.y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='fl'>15</span><span class='op'>)</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/aes.html'>aes</a></span><span class='op'>(</span>group<span class='op'>=</span><span class='va'>frame</span>,color<span class='op'>=</span><span class='va'>amp</span><span class='op'>)</span>,stat<span class='op'>=</span><span class='st'>"smooth"</span>,method <span class='op'>=</span> <span class='st'>"loess"</span>, size <span class='op'>=</span> <span class='fl'>1.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>

<span class='op'>}</span>

<span class='co'>## A very quick example using kin.simple() and kin.search().</span>

<span class='co'>#retrieve image with arguments passed to find.roi()</span>
<span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>readImage</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/img"</span>, <span class='st'>"sunfish_BCF.jpg"</span>, package <span class='op'>=</span> <span class='st'>"trackter"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#create directory and write image to it</span>
<span class='va'>t</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>writeImage</a></span><span class='op'>(</span><span class='va'>i</span>,<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images/sunfish001.jpg"</span><span class='op'>)</span>,type <span class='op'>=</span> <span class='st'>"jpeg"</span><span class='op'>)</span>

<span class='va'>fi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span>,full.names<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'>#run kin.search and save output image to directory</span>

<span class='va'>kin.srch</span><span class='op'>&lt;-</span> <span class='fu'>kin.search</span><span class='op'>(</span>image.dir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span>,
save <span class='op'>=</span> <span class='cn'>TRUE</span>,out.dir <span class='op'>=</span> <span class='va'>t</span>,search.for<span class='op'>=</span><span class='st'>"largest"</span>,size.min<span class='op'>=</span><span class='fl'>0.01</span><span class='op'>)</span>

<span class='va'>kin.simp</span><span class='op'>&lt;-</span> <span class='fu'>kin.simple</span><span class='op'>(</span>image.dir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span>,
save <span class='op'>=</span> <span class='cn'>TRUE</span>,out.dir <span class='op'>=</span> <span class='va'>t</span><span class='op'>)</span>

<span class='co'>#plot similar results</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>

<span class='va'>kin.both</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='va'>kin.srch</span><span class='op'>$</span><span class='va'>midline</span>,fun<span class='op'>=</span><span class='st'>"search"</span><span class='op'>)</span>,
<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='va'>kin.simp</span><span class='op'>$</span><span class='va'>midline</span>,fun<span class='op'>=</span><span class='st'>"simple"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/ggplot2/man/qplot.html'>qplot</a></span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>kin.both</span>,x<span class='op'>=</span><span class='va'>x</span>,y<span class='op'>=</span><span class='va'>y.sm</span>,col<span class='op'>=</span><span class='va'>fun</span><span class='op'>)</span>
</div><div class='img'><img src='kin.search-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>#' #plot midline over original image from kin.simple()</span>
<span class='va'>i2</span> <span class='op'>&lt;-</span> <span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>readImage</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/sunfish001_000.jpg"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/display.html'>display</a></span><span class='op'>(</span><span class='va'>i2</span>,method<span class='op'>=</span><span class='st'>"raster"</span><span class='op'>)</span>
</div><div class='img'><img src='kin.search-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>#clean up</span>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span>,recursive<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'>##A somewhat long example using kin.free()</span>
<span class='co'>#### plot midline waveform on images of swimming ropefish</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-datatable.com'>data.table</a></span><span class='op'>)</span>
<span class='co'>#download example video and establish directories</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='st'>"https://github.com/ckenaley/exampledata/blob/master/ropefish.avi?raw=true"</span>
<span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>f</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/ropefish.avi"</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/images"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/out"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>#extract images</span>
<span class='fu'><a href='vid.to.images.html'>vid.to.images</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/ropefish.avi"</span><span class='op'>)</span>, out.dir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/images"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>#run kin.free() </span>

<span class='va'>kin</span> <span class='op'>&lt;-</span> <span class='fu'>kin.free</span><span class='op'>(</span>image.dir <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/images"</span><span class='op'>)</span>,
      par<span class='op'>=</span><span class='cn'>TRUE</span>,
      save<span class='op'>=</span><span class='cn'>TRUE</span>,
      out.dir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/out"</span><span class='op'>)</span>,
      ml.smooth<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"spline"</span>,<span class='fl'>0.5</span><span class='op'>)</span>,
      thr <span class='op'>=</span> <span class='st'>"otsu"</span>,
      ml.meth<span class='op'>=</span><span class='st'>"ang"</span>,
      ant.pos<span class='op'>=</span><span class='st'>"l"</span>,
      red<span class='op'>=</span><span class='fl'>0.5</span>,
      size.min<span class='op'>=</span><span class='fl'>0.01</span>
      <span class='op'>)</span>


<span class='co'>#see results</span>
<span class='co'>#images</span>
<span class='va'>fi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/out"</span><span class='op'>)</span>,full.names<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/display.html'>display</a></span><span class='op'>(</span><span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>readImage</a></span><span class='op'>(</span><span class='va'>fi</span><span class='op'>[</span><span class='fl'>320</span><span class='op'>]</span><span class='op'>)</span>,<span class='st'>"raster"</span><span class='op'>)</span>

<span class='co'>#with gg.overlay() on first 300 frames</span>

<span class='fu'><a href='gg.overlay.html'>gg.overlay</a></span><span class='op'>(</span>kin<span class='op'>=</span><span class='va'>kin</span>,
under<span class='op'>=</span><span class='st'>"cont.sm"</span>,
over<span class='op'>=</span><span class='st'>"midline"</span>,
frames<span class='op'>=</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>299</span>,
size<span class='op'>=</span><span class='fl'>.2</span>,
animate<span class='op'>=</span><span class='cn'>TRUE</span>,
zoom<span class='op'>=</span><span class='cn'>FALSE</span>,
alpha<span class='op'>=</span><span class='fl'>0.01</span>,
col<span class='op'>=</span><span class='st'>"red"</span>,
fps<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span>

<span class='co'>#clean up</span>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/images"</span><span class='op'>)</span>,recursive<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/out"</span><span class='op'>)</span>,recursive<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>


<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christopher Kenaley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


