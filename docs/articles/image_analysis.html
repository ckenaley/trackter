<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Analysis • trackter</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Image Analysis">
<meta property="og:description" content="trackter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trackter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/image_analysis.html">Image Analysis</a>
    </li>
    <li>
      <a href="../articles/kinematic_analysis.html">Kinematic Analysis</a>
    </li>
    <li>
      <a href="../articles/startup.html">Starting Up</a>
    </li>
    <li>
      <a href="../articles/visualization.html">Visualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="image_analysis_files/kePrint-0.0.1/kePrint.js"></script><link href="image_analysis_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Image Analysis</h1>
            
      
      
      <div class="hidden name"><code>image_analysis.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="user-input">User input<a class="anchor" aria-label="anchor" href="#user-input"></a>
</h2>
<p>The image analysis functions <code><a href="../reference/kin.search.html">kin.search()</a></code>, <code><a href="../reference/kin.search.html">kin.simple()</a></code>, and <code><a href="../reference/kin.search.html">kin.free()</a></code> (i.e., the <a href="#the-kin-functions-1"><code>kin</code> functions</a>) require image sequences stored in a directory. The argument <code>img.dir</code> specifies which directory contains the images to be analyzed. Supported image formats include jpeg, png, and tiff.</p>
<p>Users can start analysis with images extracted from videos using some other software program (e.g., imageJ). However, they must be given unique file names that end in a sequence number. For example “image_01.jpeg”, “image_02.jpeg”, etc.</p>
<p>If the starting point of analysis is a video file, <code>trackter</code>’s <code>video.to.images()</code> can be used to extract images to a user-defined directory. This function is a wrapper for the <code>av</code> package’s <code>av_video_code()</code>. For example, the following with extract images from an 11-frame video of a swimming pumpkinseed sunfish included with the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">trackter</span><span class="op">)</span>
<span class="va">sunfish.vid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/vid"</span>, <span class="st">"sunfish_BCF_red.avi"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span><span class="op">)</span>
<span class="fu"><a href="../reference/vid.to.images.html">vid.to.images</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">sunfish.vid</span>, out.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span><span class="op">)</span></code></pre></div>
<p>The 11 files are now in the “./sunfish_images” directory and the first one is displayed</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "sunfish_BCF_red_000001.jpg" "sunfish_BCF_red_000002.jpg"</span>
<span class="co">##  [3] "sunfish_BCF_red_000003.jpg" "sunfish_BCF_red_000004.jpg"</span>
<span class="co">##  [5] "sunfish_BCF_red_000005.jpg" "sunfish_BCF_red_000006.jpg"</span>
<span class="co">##  [7] "sunfish_BCF_red_000007.jpg" "sunfish_BCF_red_000008.jpg"</span>
<span class="co">##  [9] "sunfish_BCF_red_000009.jpg" "sunfish_BCF_red_000010.jpg"</span>
<span class="co">## [11] "sunfish_BCF_red_000011.jpg"</span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,method <span class="op">=</span> <span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/filles-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="filter-extracted-images">Filter extracted images<a class="anchor" aria-label="anchor" href="#filter-extracted-images"></a>
</h2>
<p><code>video.to.images()</code> supports added <code>FFmpeg</code> functionality, allowing users to specify filters that may, for example crop, rotate, or adjust the size of the images. Filters can be passed to the <code>vfilter</code> argument as a character string, which in turn is passed to <code>av</code>s <code>av_vidoe_encode()</code>. For example, one can extract images from the same video and crop around their center at 900 pixels wide and 400 pixels deep with the following.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Crop the central input area with size 900x300:</span>
<span class="va">filt.crop</span> <span class="op">&lt;-</span> <span class="st">'crop=900:300'</span>


<span class="co">#will overwrite images in the directory</span>
<span class="fu"><a href="../reference/vid.to.images.html">vid.to.images</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">sunfish.vid</span>, out.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span>, vfilter<span class="op">=</span><span class="va">filt.crop</span>,overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># extract</span></code></pre></div>
<pre><code><span class="co">## Extra audio frame dropped from output</span></code></pre>
<p>Now, display one of the cropped images.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,method <span class="op">=</span> <span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/dispcrop-1.png" width="700"> To learn more about filters, users can check out the <a href="https://ffmpeg.org/ffmpeg-filters.html" class="external-link"><code>FFmpeg</code> wiki site</a>.</p>
<p>Here’s another example with a filter that doubles the contrast.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#boost the contrast</span>
<span class="va">filt.br</span> <span class="op">&lt;-</span> <span class="st">'eq=contrast=2'</span>

<span class="co">#extract and filter (overwriting the previous extraction)</span>
<span class="fu"><a href="../reference/vid.to.images.html">vid.to.images</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">sunfish.vid</span>, out.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span>, vfilter <span class="op">=</span> <span class="va">filt.br</span>,overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">## Extra audio frame dropped from output</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#display</span>
<span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,method <span class="op">=</span> <span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/cont-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#clean up</span>
<span class="co">#unlink("./sunfish_images",recursive = TRUE)</span></code></pre></div>
<p>For those who simply want to crop images or change their contrast without using <code>FFmpeg</code> filters, <code>trackter</code> offers <code><a href="../reference/crop.img.html">crop.img()</a></code> and <code><a href="../reference/contrast.img.html">contrast.img()</a></code>, respectively. Continuing with the same image sequence, <code><a href="../reference/crop.img.html">crop.img()</a></code> is used here to crop the images with a rectangle described the arguments <code>ul</code> (the lower left xy position) and <code>br</code> (the bottom right xy position) and save them the a directory specified by <code>out.dir</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#create the out.dir</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./sunfish_images2"</span><span class="op">)</span>

<span class="co">#crop at pixels 5,150 and 900,400</span>
<span class="fu"><a href="../reference/crop.img.html">crop.img</a></span><span class="op">(</span>img<span class="op">=</span><span class="st">"./sunfish_images"</span>,out.dir <span class="op">=</span><span class="st">"./sunfish_images2"</span>,ul<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">150</span><span class="op">)</span>,br<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">900</span>,<span class="fl">400</span><span class="op">)</span><span class="op">)</span>

<span class="co">#display the first cropped image in the sequence</span>
<span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="st">"./sunfish_images2/sunfish_BCF_red_000001.jpg"</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/cropfun-1.png" width="700"></p>
<p>Here, the same image sequence has its contrast enhanced with <code><a href="../reference/contrast.img.html">contrast.img()</a></code>. Contrast is doubled in this case with the argument <code>c=2</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#contrast and overwrite imgages in out.dir</span>
<span class="fu"><a href="../reference/contrast.img.html">contrast.img</a></span><span class="op">(</span>img<span class="op">=</span><span class="st">"./sunfish_images"</span>,out.dir <span class="op">=</span><span class="st">"./sunfish_images2"</span>,c<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="co">#display the first cropped image in the sequence</span>
<span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="st">"./sunfish_images2/sunfish_BCF_red_000001.jpg"</span><span class="op">)</span>,method<span class="op">=</span><span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/contfun-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="thresholding">Thresholding<a class="anchor" aria-label="anchor" href="#thresholding"></a>
</h2>
<p>The thresholding process is an important step in many computer vision algorithms and the most straightforward method for segmenting (i.e., identifying) ROIs from an image field. In its simplest form, thresholding creates a binary image by classifying pixels as either white or black depending on their grayscale intensity. That is, each pixel in an image is replaced with a black pixel if its intensity is less than a fixed value and replaced a white pixel if its intensity is greater than this value. This threshold value is often represeted as the range of the image intensity scaled from 0–1.</p>
<p>The internal function <code><a href="../reference/find.roi.html">find.roi()</a></code> in <code>trackter</code> (on which all the <code>kin</code> functions depend) segments an image based on this simple process. By default, <code><a href="../reference/find.roi.html">find.roi()</a></code> automatically determines the threshold value by using <a href="https://en.wikipedia.org/wiki/Otsu%27s_method" class="external-link">Otsu’s method</a>. This approach finds a threshold value that separates pixels into foreground and background classes by maximizing the variance between the foreground and background pixels. Optionally, users can specify a threshold value of 0–1 for the <code>thr</code> argument in the <code>kin</code> functions, which is in turn passed to <code><a href="../reference/find.roi.html">find.roi()</a></code>.</p>
<p>For most cases where there is considerable contrast between the background and the target ROI (i.e., the fish, etc.), Otsu’s automatic threshold value will suffice. However, users can evaluate the binary results of their images with the <code><a href="../reference/thr.check.html">thr.check()</a></code> function before proceeding with ROI detection and analysis with the <code>kin</code> functions.</p>
<p>As an example, here’s an image of a swimming pumpkinseed sunfish that’s loaded with the package. For subsequent analysis, it is copied to an appropriately named directory.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">im</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/img/sunfish_BCF.jpg"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./images"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">im</span>,<span class="st">"./images/sunfish_BCF.jpg"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span><span class="op">)</span>,<span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/sunimg-1.png" width="700"></p>
<p>Now, we can check the binary results of 9 separate threshold values, 0.1–0.9 by default. Notice that <code><a href="../reference/thr.check.html">thr.check()</a></code> also prints the automatically calculated Otsu value for reference.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">trackter</span><span class="op">)</span>
<span class="fu"><a href="../reference/thr.check.html">thr.check</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/thrcheck-1.png" width="700"></p>
<pre><code><span class="co">## [1] 0.5605469</span></code></pre>
<p>Users can alter the range of threshold values that are used for the nine binary images with the <code>min</code> and <code>max</code> arguments. For example . . .</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/thr.check.html">thr.check</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span>,min <span class="op">=</span> <span class="fl">0.2</span>,max<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/thrcheck2-1.png" width="700"></p>
<pre><code><span class="co">## [1] 0.5605469</span></code></pre>
</div>
<div class="section level2">
<h2 id="the-kin-functions">The <code>kin</code> functions<a class="anchor" aria-label="anchor" href="#the-kin-functions"></a>
</h2>
<div class="section level3">
<h3 id="kin-functions-output">
<code>kin</code> functions output<a class="anchor" aria-label="anchor" href="#kin-functions-output"></a>
</h3>
<p>Functionality and output within <code>trackter</code> make use of the <code>data.table</code> structure. Objects returned by <code>trackter</code>’s <code>kin</code> functions can be rather large for even modest analyses (e.g., hundreds of rows of midline coordinates from hundreds of frames). All three <code>kin</code> functions, <code><a href="../reference/kin.search.html">kin.simple()</a></code>, <code><a href="../reference/kin.search.html">kin.search()</a></code>, and <code><a href="../reference/kin.search.html">kin.free()</a></code>, return data as a list of data tables. Specifically, these include:</p>
<ul>
<li>
<code>kin.dat</code>: A data table consisting of frame-by-frame position parameters for the ROI determined by the <code>search.for</code> argument (see below).</li>
<li>
<code>midline</code>: A data table containing, for each frame described by the <code>frames</code> argument, the x and y position of the midline. This also includes midline points fit to a smooth spline or loess model.</li>
<li>
<code>cont</code>: A data table containing x and y positions of the contours used to calculate the data in the <code>kin.dat</code> and <code>midline</code> tables.</li>
<li>
<code>cont.sm</code>: A data table containing the smoothed x and y positions of the contours.</li>
<li>
<code>all.classes</code>: A data table containing position data for all ROIs detected.</li>
<li>
<code>mid.pred</code>: A data table containing the theoretical midline based on a linear model of the head. The argument <code>ant.per</code> is used to isolate the head and this section of the midline produces the linear prediction that extends the length of the ROI.</li>
<li>
<code>dim</code>: the x and y dimensions of the images analyzed</li>
</ul>
<p>The components of each table are described in detail within the documentation for the <code>kin</code> functions (e.g., <code>?kin.search()</code>).</p>
<p>In addition to the table output, if the <code>save</code> argument is set to <code>TRUE</code>, the <code>'kin</code> functions will save midline data over the original images in a specified output directory. This capability is outlined in the <a href="visualization.html">Visualization article</a>.</p>
</div>
<div class="section level3">
<h3 id="when-to-use-each-of-the-kin-functions">When to use each of the <code>kin</code> functions<a class="anchor" aria-label="anchor" href="#when-to-use-each-of-the-kin-functions"></a>
</h3>
<p>Users of <code>trackter</code> have three <code>kin</code> functions available for the extraction of target ROIs and initial kinematic analysis: <code><a href="../reference/kin.search.html">kin.search()</a></code>, <code><a href="../reference/kin.search.html">kin.simple()</a></code>, and <code><a href="../reference/kin.search.html">kin.free()</a></code>. The choice of which <code>kin</code> function to use is not arbitrary and depends on the experimental condition. Suggested uses are summarized here:</p>
<table class="table">
<thead><tr>
<th style="text-align:left;">
kin function
</th>
<th style="text-align:left;">
experimental condition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
kin.simple()
</td>
<td style="text-align:left;width: 30em; ">
relatively static in the image field, intended ROI is largest, typical flume experiments
</td>
</tr>
<tr>
<td style="text-align:left;">
kin.search()
</td>
<td style="text-align:left;width: 30em; ">
relatively static in the image field, other large non-ROIs in the image field, typical flume experiments with objects meant to alter flow
</td>
</tr>
<tr>
<td style="text-align:left;">
kin.free()
</td>
<td style="text-align:left;width: 30em; ">
free-moving ROI, with or without objects meant to alter flow
</td>
</tr>
</tbody>
</table>
<p>The <code>kin</code> functions use <code><a href="../reference/find.roi.html">find.roi()</a></code> to segment and screen candidate ROIs, applying the thresholding techniques described above. After binarization and segmentation, <code><a href="../reference/find.roi.html">find.roi()</a></code> produces a list of candidate ROIs that are filtered according to a few criteria. Users can pass a few or all arguments related to these criteria to <code><a href="../reference/find.roi.html">find.roi()</a></code>, depending on which <code>kin</code> function they use for image analysis.</p>
<p>One screening argument is recognized in all three <code>kin</code> functions. As the target ROI in swimming experiments is typically large relative to the image field, users can filter ROIs by specifying a minimum size (in % area of the 2D pixel field) with the argument <code>size.min</code>.</p>
<p><code><a href="../reference/kin.search.html">kin.simple()</a></code>, as the name implies, segments and screens ROIs with <code><a href="../reference/find.roi.html">find.roi()</a></code> using only the the size criterion. This is intended for simple, yet often attainable conditions where the non-target ROIs are smaller than the target, e.g., a swimming animal taking up most of the image field. This condition is satisfied in the image displayed above and <code><a href="../reference/kin.search.html">kin.simple()</a></code> performs just fine in extracting position and contour data.</p>
<p>Here, the image above is analyzed using <code><a href="../reference/kin.search.html">kin.simple()</a></code>and then the trailing edge (‘x’ and ‘y’ in the <code>kin.dat</code> table returned by <code><a href="../reference/kin.search.html">kin.simple()</a></code>) is plotted over this frame using <code>trackter</code>’s <code><a href="../reference/data.overlay.html">data.overlay()</a></code> function.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#run kin.simple()</span>
<span class="va">kin.sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.simple</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `data_frame()` was deprecated in tibble 1.1.0.</span>
<span class="co">## Please use `tibble()` instead.</span>
<span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#overlay the position of the trailing edge</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span>,over<span class="op">=</span><span class="va">kin.sim</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/simoutput-1.png" width="700"></p>
<p>For image fields that contain other large contrasted objects, <code><a href="../reference/kin.search.html">kin.search()</a></code> or <code><a href="../reference/kin.search.html">kin.free()</a></code> should be used as they pass additional arguments to <code><a href="../reference/find.roi.html">find.roi()</a></code> via the <code>search.for</code> option. This argument accepts one of four values that result in different search criteria:</p>
<ul>
<li>
<code>search.for='offset'</code>: A centroid that is the shortest linear distance to the center of the field</li>
<li>
<code>search.for='offset.x'</code>: A centroid x position that is closest to the x position of the center of the field</li>
<li>
<code>search.for='offset.y'</code>: A centroid y position that is closest to the y position of the center of the field ()</li>
<li>
<code>search.for='largest'</code>: The largest ROI (the default)</li>
</ul>
<p>As an example, let’s consider a different scenario in which a large obstruction is placed in the flume to alter the flow, as in the image below.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">im2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/img"</span>, <span class="st">"sunfish_search2.jpg"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./images2"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">im2</span>,<span class="st">"./images2/sunfish_search2.jpg"</span><span class="op">)</span>
<span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html" class="external-link">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html" class="external-link">readImage</a></span><span class="op">(</span><span class="st">"./images2/sunfish_search2.jpg"</span><span class="op">)</span>,<span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/searchcomp2-1.png" width="700"></p>
<p>In this case, <code><a href="../reference/kin.search.html">kin.simple()</a></code> is a poor choice. It finds the trailing edge of the largest ROI, as expected.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.simple</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span><span class="op">)</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="st">"./images2/sunfish_search2.jpg"</span>,over<span class="op">=</span><span class="va">kin.sim</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p><code><a href="../reference/kin.search.html">kin.search()</a></code>, which permits more flexible ROI filtering, is the better choice. With <code>search.for='offset'</code>,<code><a href="../reference/kin.search.html">kin.search()</a></code> finds the ROI with a centroid that is closest to the image center.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.srch1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span>, search.for<span class="op">=</span><span class="st">"offset"</span><span class="op">)</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span>img <span class="op">=</span> <span class="st">"./images2/sunfish_search2.jpg"</span>,over<span class="op">=</span><span class="va">kin.srch1</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/searchcomp3-1.png" width="700"></p>
<p>Using <code>search.for='offset.x'</code> or <code>search.for='offset.y'</code> yields the same results in this case (the red and blue symbols, respectively).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.srch2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span>, search.for<span class="op">=</span><span class="st">"offset.x"</span>,ant.per <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span>
<span class="va">kin.srch3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span>, search.for<span class="op">=</span><span class="st">"offset.y"</span>,ant.per <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span>img <span class="op">=</span><span class="st">"./images2/sunfish_search2.jpg"</span>,over<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">kin.srch2</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,<span class="va">kin.srch3</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/searchcomp4-1.png" width="700"></p>
<p>The functions <code><a href="../reference/kin.search.html">kin.simple()</a></code> and <code><a href="../reference/kin.search.html">kin.search()</a></code> assume that ROIs maintains a largely horizontal, static, and left-facing position in the image field, i.e., that the anterior (leading edge) is left of the posterior (trailing edge). Using these two functions, the midline of the body contour is calculated as the vertical midpoint between minimum and maximum y values at each x position along the body contour.</p>
<p>This, of course, isn’t a condition met for many experimental conditions, especially for free swimming organism. For instance, for an S-shape contour oriented vertically, calculations of the midline using the algorithm implemented in <code><a href="../reference/kin.search.html">kin.simple()</a></code> and <code><a href="../reference/kin.search.html">kin.search()</a></code> would yield more than one four or more y coordinates for every x coordinate. One could constantly rotate the ROI’s contour when this is the case for any frame in a series, but then this introduces the problem of the relative positions between frames being meaningless. <code>trackter</code>’s <code><a href="../reference/kin.search.html">kin.free()</a></code> function can be used in the case of free-swimming or erratically positioned organisms.</p>
<p>Take for instance, a 50-frame video of a crawling roundworm (<em>C. elegans</em>) from the supplementary material in <span class="citation">@pierce2008genetic</span> is analyzed. After image extraction, both <code><a href="../reference/kin.search.html">kin.search()</a></code> and <code><a href="../reference/kin.search.html">kin.free()</a></code> are run on the image sequence in a new directory. Notice that, for <code><a href="../reference/kin.search.html">kin.free()</a></code>, the chosen midline method is Delaunay triangulation (<code>ml.meth = 'del'</code>, see <a href="#midline_estimation">below</a>). Not that, due to the worm’s small size in the image field, the minimum size argument is set to <code>size.min=0.01</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.vid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/vid"</span>, <span class="st">"celegans3.avi"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./cel_images"</span><span class="op">)</span>
<span class="fu"><a href="../reference/vid.to.images.html">vid.to.images</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">cel.vid</span>, out.dir <span class="op">=</span> <span class="st">"./cel_images"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Extra audio frame dropped from output</span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.cel</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./cel_images"</span>,thr<span class="op">=</span><span class="fl">0.8</span>,ant.per<span class="op">=</span><span class="fl">0.1</span>,size.min<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>
<span class="va">kin.cel.fr</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.free</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./cel_images"</span>,ml.meth <span class="op">=</span> <span class="st">"del"</span>,thr<span class="op">=</span><span class="fl">0.8</span>,ant.per<span class="op">=</span><span class="fl">0.1</span>,size.min<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p>Now, the results of the midline retrieved by the two methods are compared. First, the results for <code><a href="../reference/kin.search.html">kin.search()</a></code> are plotted over an original frame using <code><a href="../reference/data.overlay.html">data.overlay()</a></code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.img1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./cel_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">cel.img1</span>,over<span class="op">=</span><span class="va">kin.cel</span><span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/celoverlay-1.png" width="700"></p>
<p>Now the results using <code><a href="../reference/kin.search.html">kin.free()</a></code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">cel.img1</span>,over<span class="op">=</span><span class="va">kin.cel.fr</span><span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/celoverlay2-1.png" width="700"></p>
<p>As you can see, <code><a href="../reference/kin.search.html">kin.free()</a></code> performs much better.</p>
</div>
</div>
<div class="section level2">
<h2 id="midline-estimation">Midline estimation<a class="anchor" aria-label="anchor" href="#midline-estimation"></a>
</h2>
<p>As with the other <code>kin</code> functions, <code><a href="../reference/kin.search.html">kin.free()</a></code> also relies on <code><a href="../reference/find.roi.html">find.roi()</a></code>, but estimates the midline—and therefore the head and trailing-edge positions—by one of three user-defined methods implemented in these internal functions:</p>
<ul>
<li>
<code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code>: creates a convex hull around the ROI’s contour and then defines the anterior and posterior tips as the two coordinates in the hull that are farthest from one another. This function then bisects the contour across an axis determined by the tips, creates two vectors of equally spaced coordinates for each half of the body, and then calculates the midline as the average x and y position of each ordered pair of contour coordinates.</li>
<li>
<code><a href="../reference/free.ml.ang.html">free.ml.ang()</a></code>: performs the same operations as <code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code>, but, before bisection, refines the tips by finding coordinates that form the vertex of the sharpest angle within end regions of the contour. *<code><a href="../reference/free.ml.ang.html">free.ml.del()</a></code>: estimates the midline coordinates through Delaunay triangulation and Voronoi tessellation using the R package <code>deldir</code>. Invoking functions from the <code>sp</code> and <code>igraph</code> packages, triangulated points that lie within the contour are used to build a distance-weighted minimum spanning tree that expands until the path intersects with the contour. The extrema of the midline path are then indexed as the first and last according to their distance from one of the candidate tips found using a hull as in <code>free.ml.hull</code> and <code>free.ml.ang</code>.</li>
</ul>
<p><code><a href="../reference/free.ml.ang.html">free.ml.ang()</a></code>and <code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code> may be more appropriate for complicated outlines (i.e., those with appendages). <code>free.ml.del</code> tends to produce better results when an ROI has contour regions that overlap (i.e, kinks or snakes back on itself); however, it produces less precise midlines for complicated contours and is slower for high resolution outlines. In the example above, <code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code> and <code><a href="../reference/free.ml.ang.html">free.ml.del()</a></code> perform equally as well.</p>
<p>Note that reducing the resolution with argument ‘red’ when implementing these functions in <code><a href="../reference/kin.search.html">kin.free()</a></code> may hasten the speed considerably.</p>
<p>To see their different approaches and outcomes, these three functions are run on a smoothed contour retrieved from <code><a href="../reference/kin.search.html">kin.free()</a></code>. Note that the <code>free.ml()</code> functions take a matrix with named x and y columns as input.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.cont</span> <span class="op">&lt;-</span> <span class="va">kin.cel.fr</span><span class="op">$</span><span class="va">cont.sm</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">cel.cont</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/celcont-1.png" width="700"></p>
<p>Now the three midline functions are run on this contour.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.ml.ang</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/free.ml.ang.html">free.ml.ang</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cel.cont</span><span class="op">)</span><span class="op">)</span>
<span class="va">cel.ml.hull</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/free.ml.ang.html">free.ml.hull</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cel.cont</span><span class="op">)</span><span class="op">)</span>
<span class="va">cel.ml.del</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/free.ml.ang.html">free.ml.del</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cel.cont</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can have a look at the midline retrieved by these three functions plotted over the smoothed contour using <code>ggplot</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.ml.ang</span><span class="op">$</span><span class="va">ml</span><span class="op">[</span>,<span class="va">`function`</span><span class="op">:=</span><span class="st">"free.ml.ang()"</span><span class="op">]</span>
<span class="va">cel.ml.hull</span><span class="op">$</span><span class="va">ml</span><span class="op">[</span>,<span class="va">`function`</span><span class="op">:=</span><span class="st">"free.ml.hull()"</span><span class="op">]</span>
<span class="va">cel.ml.del</span><span class="op">$</span><span class="va">ml</span><span class="op">[</span>,<span class="va">`function`</span><span class="op">:=</span><span class="st">"free.ml.del()"</span><span class="op">]</span>

<span class="va">cel.ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cel.ml.ang</span><span class="op">$</span><span class="va">ml</span>,<span class="va">cel.ml.hull</span><span class="op">$</span><span class="va">ml</span>,<span class="va">cel.ml.del</span><span class="op">$</span><span class="va">ml</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/qplot.html" class="external-link">qplot</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">kin.cel.fr</span><span class="op">$</span><span class="va">cont.sm</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>,x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">cel.ml</span>,<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">`function`</span><span class="op">~</span><span class="va">.</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/celmlcomp-1.png" width="700"></p>
<p>In <code><a href="../reference/kin.search.html">kin.free()</a></code>, the position of the anterior of the ROI (i.e., the leading edge) is determined by the displacement of the ROI between the first two frames. Thus, the use of <code><a href="../reference/kin.search.html">kin.free()</a></code> requires the analysis of at least two frames. For analyses of relatively static ROIs in the field (e.g., steadily swimming animals in flumes, etc.), automatically determining the anterior of the ROI may be spurious. In this case, the default automatic determination of the anterior can be overridden by specifying ‘l’, ‘r’, ‘u’, ‘d’ with the argument <code>ant.pos</code>. These values specify that the anterior region of the ROI is leftmost, rightmost, upmost, or downmost in the field, respectively, and assumes that the origin of the pixel field (0,0) is the upper left corner of each frame.</p>
<p>Using <code><a href="../reference/kin.search.html">kin.free()</a></code> in these cases will come at a cost in terms of processing speed due to the more involved midline procedure with the <code>free.ml</code> functions. Therefore, if the ROI is oriented nearly horizontally, <code><a href="../reference/kin.search.html">kin.simple()</a></code> or <code><a href="../reference/kin.search.html">kin.search()</a></code> will produce similar results faster.</p>
<p>To demonstrate the similar results, yet increased processing time, <code><a href="../reference/kin.search.html">kin.simple()</a></code> and <code><a href="../reference/kin.search.html">kin.free()</a></code> are run on an 11-frame video of a swimming pumpkinseed sunfish after image extraction with <code>vid.to.images2()</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sunfish.vid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/vid"</span>, <span class="st">"sunfish_BCF_red.avi"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in dir.create("./sunfish_images"): './sunfish_images' already exists</span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vid.to.images.html">vid.to.images</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">sunfish.vid</span>, out.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Extra audio frame dropped from output</span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">sunfish.kin.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.simple</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span>,ml.meth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"spline"</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    user  system elapsed </span>
<span class="co">##   3.072   0.594   3.800</span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">sunfish.kin.fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.free</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span>,ant.pos <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Attaching package: 'data.table'</span></code></pre>
<pre><code><span class="co">## The following objects are masked from 'package:dplyr':</span>
<span class="co">## </span>
<span class="co">##     between, first, last</span></code></pre>
<pre><code><span class="co">##    user  system elapsed </span>
<span class="co">##   9.838   1.083  12.390</span></code></pre>
<p>Now the results are plotted for a single frame using <code><a href="../reference/data.overlay.html">data.overlay()</a></code>. First he results from <code><a href="../reference/kin.search.html">kin.simple()</a></code>, then the results fron <code><a href="../reference/kin.search.html">kin.free()</a></code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sunfish.frame1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">sunfish.frame1</span>,over<span class="op">=</span><span class="va">sunfish.kin.sim</span> <span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">0</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y.sm</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">sunfish.frame1</span>,over<span class="op">=</span><span class="va">sunfish.kin.fr</span> <span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">0</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y.sm</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="image_analysis_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Despite the increased processing time, using <code><a href="../reference/kin.search.html">kin.free()</a></code> may be an attractive option if the target ROI is static and oriented vertically or toward a corner of the image field.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christopher Kenaley.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
