<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Analysis • trackter</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Image Analysis">
<meta property="og:description" content="trackter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trackter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/image_processing.html">Video and Image Processing</a>
    </li>
    <li>
      <a href="../articles/kin_functions.html">Image Analysis</a>
    </li>
    <li>
      <a href="../articles/kinematic_analysis.html">Kinematic Analysis</a>
    </li>
    <li>
      <a href="../articles/tutorial.html">Short Tutorial</a>
    </li>
    <li>
      <a href="../articles/visualization.html">Vizualization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="kin_functions_files/header-attrs-2.11/header-attrs.js"></script><script src="kin_functions_files/kePrint-0.0.1/kePrint.js"></script><link href="kin_functions_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Image Analysis</h1>
            
      
      
      <div class="hidden name"><code>kin_functions.Rmd</code></div>

    </div>

    
    
<div id="thresholding" class="section level2">
<h2 class="hasAnchor">
<a href="#thresholding" class="anchor"></a>Thresholding</h2>
<p>The thresholding process is an important step in many computer vision algorithms and the most straightforward method for segmenting (i.e., identifying) ROIs from an image field. In its simplest form, thresholding creates a binary image by classifying pixels as either white or black depending on their grayscale intensity. That is, each pixel in an image is replaced with a black pixel if its intensity is less than a fixed value and replaced a white pixel if its intensity is greater than this value. This threshold value is often represeted as the range of the image intesity scaled from 0–1.</p>
<p>The internal function <code><a href="../reference/find.roi.html">find.roi()</a></code> in <code>trackter</code> (on which all the <code>kin</code> functions depend) segments an image based on this simple process. By default, <code><a href="../reference/find.roi.html">find.roi()</a></code> automatically determines the threshold value by using <a href="https://en.wikipedia.org/wiki/Otsu%27s_method">Otsu’s method</a>. This approach finds a threshold value that separates pixels into foreground and background classes by maximizing the variance between the foreground and background pixels. Optionally, users can specify a threshold value of 0–1 for the <code>thr</code> argument in the <code>kin</code> functions, which is in turn passed to <code><a href="../reference/find.roi.html">find.roi()</a></code>.</p>
<p>For most cases where there is considerable contrast between the background and the target ROI (i.e., the fish, etc.), Otsu’s automatic threshold value will suffice. However, users can evaluate the binary results of their images with the <code><a href="../reference/thr.check.html">thr.check()</a></code> function before proceeding with ROI detection and analysis with the <code>kin</code> functions.</p>
<p>As an example, here’s an image of a swimming pumpkinseed sunfish that’s loaded with the package. For subsequent analysis, it is copied to an appropriately named directory.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">im</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/img/sunfish_BCF.jpg"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"./images"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span><span class="va">im</span>,<span class="st">"./images/sunfish_BCF.jpg"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html">readImage</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span><span class="op">)</span>,<span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/unnamed-chunk-1-1.png" width="700"> Now, we can check the binary results of 9 separate threshold values, 0.1–0.9 by default. Notice that <code><a href="../reference/thr.check.html">thr.check()</a></code> also prints the automatically calculated Otsu value for reference.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">trackter</span><span class="op">)</span>
<span class="fu"><a href="../reference/thr.check.html">thr.check</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<pre><code>## [1] 0.5605469</code></pre>
<p>Users can alter the range of threshold values that are used for the nine binary images with the <code>min</code> and <code>max</code> arguments. For example . . .</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/thr.check.html">thr.check</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span>,min <span class="op">=</span> <span class="fl">0.2</span>,max<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<pre><code>## [1] 0.5605469</code></pre>
</div>
<div id="the-kin-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#the-kin-functions" class="anchor"></a>The <code>kin</code> functions</h2>
<p>Users of <code>trackter</code> have three <code>kin</code> functions available for the extraction of target ROIs and initial kinematic analysis: <code><a href="../reference/kin.search.html">kin.search()</a></code>, <code><a href="../reference/kin.search.html">kin.simple()</a></code>, and <code><a href="../reference/kin.search.html">kin.free()</a></code>. The choice of which <code>kin</code> function to use is not arbitrary and depends on the experimental condition. Suggested uses are summarized here:</p>
<table class="table">
<thead><tr>
<th style="text-align:left;">
kin function
</th>
<th style="text-align:left;">
experimental condition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
kin.simple()
</td>
<td style="text-align:left;width: 30em; ">
relatively static in the image field, intended ROI is largest, typical flume experiments
</td>
</tr>
<tr>
<td style="text-align:left;">
kin.search()
</td>
<td style="text-align:left;width: 30em; ">
relatively static in the image field, other large non-ROIs in the image field, typical flume experiments with objects meant to alter flow
</td>
</tr>
<tr>
<td style="text-align:left;">
kin.free()
</td>
<td style="text-align:left;width: 30em; ">
free-moving ROI, with or without objects meant to alter flow
</td>
</tr>
</tbody>
</table>
<p>The <code>kin</code> functions use <code><a href="../reference/find.roi.html">find.roi()</a></code> to segment and screen candidate ROIs, applying the thresholding techniques described above. After binarization and segmentation, <code><a href="../reference/find.roi.html">find.roi()</a></code> produces a list of candidate ROIs that are filtered according to a few criteria. Users can pass a few or all arguments related to these criteria to <code><a href="../reference/find.roi.html">find.roi()</a></code>, depending on which <code>kin</code> function they use for image analysis.</p>
<p>One screening argument is recognized in all three <code>kin</code> functions. As the target ROI in swimming experiments is typically large relative to the image field, users can filter ROIs by specifying a minimum size (in % area of the 2D pixel field) with the argument <code>size.min</code>.</p>
<p><code><a href="../reference/kin.search.html">kin.simple()</a></code>, as the name implies, segments and screens ROIs with <code><a href="../reference/find.roi.html">find.roi()</a></code> using only the the size criterion. This is intended for simple, yet often attainable conditions where the non-target ROIs are smaller than the target, e.g., a swimming animal taking up most of the image field. This condition is satisfied in the image displayed above and <code><a href="../reference/kin.search.html">kin.simple()</a></code> performs just fine in extracting position and contour data.</p>
<p>Here, the image above is analyzed using <code><a href="../reference/kin.search.html">kin.simple()</a></code>and then the trailing edge (‘x’ and ‘y’ in the <code>kin.dat</code> table returned by <code><a href="../reference/kin.search.html">kin.simple()</a></code>) is plotted over this frame using <code>trackter</code>’s <code><a href="../reference/data.overlay.html">data.overlay()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#run kin.simple()</span>
<span class="va">kin.sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.simple</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: `data_frame()` was deprecated in tibble 1.1.0.
## Please use `tibble()` instead.</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#overlay the position of the trailing edge</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="st">"./images/sunfish_BCF.jpg"</span>,over<span class="op">=</span><span class="va">kin.sim</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/simoutput-1.png" width="700"></p>
<p>For image fields that contain other large contrasted objects, <code><a href="../reference/kin.search.html">kin.search()</a></code> or <code><a href="../reference/kin.search.html">kin.free()</a></code> should be used as they pass additional arguments to <code><a href="../reference/find.roi.html">find.roi()</a></code> via the <code>search.for</code> option. This argument accepts one of four values that result in different search criteria:</p>
<ul>
<li>
<code>search.for='offset'</code>: A centroid that is the shortest linear distance to the center of the field</li>
<li>
<code>search.for='offset.x'</code>: A centroid x position that is closest to the x position of the center of the field</li>
<li>
<code>search.for='offset.y'</code>: A centroid y position that is closest to the y position of the center of the field ()</li>
<li>
<code>search.for='largest'</code>: The largest ROI (the default)</li>
</ul>
<p>As an example, let’s consider a different scenario in which a large obstruction is placed in the flume to alter the flow, as in the image below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">im2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/img"</span>, <span class="st">"sunfish_search2.jpg"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"./images2"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in dir.create("./images2"): './images2' already exists</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span><span class="va">im2</span>,<span class="st">"./images2/sunfish_search2.jpg"</span><span class="op">)</span>
<span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/display.html">display</a></span><span class="op">(</span><span class="fu">EBImage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EBImage/man/io.html">readImage</a></span><span class="op">(</span><span class="st">"./images2/sunfish_search2.jpg"</span><span class="op">)</span>,<span class="st">"raster"</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/searchcomp2-1.png" width="700"> In this case, <code><a href="../reference/kin.search.html">kin.simple()</a></code> is a poor choice. It finds the trailing edge of the largest ROI, as expected.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.simple</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span><span class="op">)</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="st">"./images2/sunfish_search2.jpg"</span>,over<span class="op">=</span><span class="va">kin.sim</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p><code><a href="../reference/kin.search.html">kin.search()</a></code>, which permits more flexible ROI filtering, is the better choice. With <code>search.for='offset'</code>,<code><a href="../reference/kin.search.html">kin.search()</a></code> finds the ROI with a centroid that is closest to the image center.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.srch1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span>, search.for<span class="op">=</span><span class="st">"offset"</span><span class="op">)</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span>img <span class="op">=</span> <span class="st">"./images2/sunfish_search2.jpg"</span>,over<span class="op">=</span><span class="va">kin.srch1</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/searchcomp3-1.png" width="700"></p>
<p>Using <code>search.for='offset.x'</code> or <code>search.for='offset.y'</code> yields the same results in this case (the red and blue symbols, respectively).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kin.srch2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span>, search.for<span class="op">=</span><span class="st">"offset.x"</span>,ant.per <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span>
<span class="va">kin.srch3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./images2"</span>, search.for<span class="op">=</span><span class="st">"offset.y"</span>,ant.per <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span>img <span class="op">=</span><span class="st">"./images2/sunfish_search2.jpg"</span>,over<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">kin.srch2</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,<span class="va">kin.srch3</span><span class="op">$</span><span class="va">kin.dat</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/searchcomp4-1.png" width="700"></p>
<p>The functions <code><a href="../reference/kin.search.html">kin.simple()</a></code> and <code><a href="../reference/kin.search.html">kin.search()</a></code> assume that ROIs maintains a largely horizontal, static, and left-facing position in the image field, i.e., that the anterior (leading edge) is left of the posterior (trailing edge). Using these two functions, the midline of the body contour is calculated as the vertical midpoint between minimum and maximum y values at each x position along the body contour.</p>
<p>This, of course, isn’t a condition met for many experimental conditions, especially for free swimming organism. For instance, for an S-shape contour oriented vertically, calculations of the midline using the algorithm implemented in <code><a href="../reference/kin.search.html">kin.simple()</a></code> and <code><a href="../reference/kin.search.html">kin.search()</a></code> would yield more than one four or more y coordinates for every x coordinate. One could constantly rotate the ROI’s contour when this is the case for any frame in a series, but then this introduces the problem of the relative positions between frames being meaningless. <code>trackter</code>’s <code><a href="../reference/kin.search.html">kin.free()</a></code> function can be used in the case of free-swimming or erratically positioned organisms.</p>
<p>Take for instance, a 50-frame video of a crawling roundworm (<em>C. elegans</em>) from the supplementary material in <span class="citation">@pierce2008genetic</span> is analyzed. After image extraction, both <code><a href="../reference/kin.search.html">kin.search()</a></code> and <code><a href="../reference/kin.search.html">kin.free()</a></code> are run on the image sequence in a new directory. Notice that, for <code><a href="../reference/kin.search.html">kin.free()</a></code>, the chosen midline method is Delauney triangulation (<code>ml.meth = 'del'</code>, see <a href="#midline_estimation">below</a>). Not that, due to the worm’s small size in the image field, the minimum size argument is set to <code>size.min=0.01</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.vid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/vid"</span>, <span class="st">"celegans3.AVI"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"./cel_images"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in dir.create("./cel_images"): './cel_images' already exists</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vid.to.images2.html">vid.to.images2</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">cel.vid</span>, out.dir <span class="op">=</span> <span class="st">"./cel_images"</span><span class="op">)</span>

<span class="va">kin.cel</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.search</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./cel_images"</span>,thr<span class="op">=</span><span class="fl">0.8</span>,ant.per<span class="op">=</span><span class="fl">0.1</span>,size.min<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>
<span class="va">kin.cel.fr</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.free</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./cel_images"</span>,ml.meth <span class="op">=</span> <span class="st">"del"</span>,thr<span class="op">=</span><span class="fl">0.8</span>,ant.per<span class="op">=</span><span class="fl">0.1</span>,size.min<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p>Now, the results of the midline retrieved by the two methods are compared. First, the results for <code><a href="../reference/kin.search.html">kin.search()</a></code> are plotted over an original frame using <code><a href="../reference/data.overlay.html">data.overlay()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.img1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"./cel_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">cel.img1</span>,over<span class="op">=</span><span class="va">kin.cel</span><span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/celoverlay-1.png" width="700"></p>
<p>Now the results using <code><a href="../reference/kin.search.html">kin.free()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">cel.img1</span>,over<span class="op">=</span><span class="va">kin.cel.fr</span><span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/celoverlay2-1.png" width="700"></p>
<p>As you can see, <code><a href="../reference/kin.search.html">kin.free()</a></code> performs much better.</p>
</div>
<div id="midline-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#midline-estimation" class="anchor"></a>Midline estimation</h2>
<p>As with the other <code>kin</code> functions, <code><a href="../reference/kin.search.html">kin.free()</a></code> also relies on <code><a href="../reference/find.roi.html">find.roi()</a></code>, but estimates the midline—and therefore the head and trailing-edge positions—by one of three user-defined methods implemented in these internal functions:</p>
<ul>
<li>
<code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code>: creates a convex hull around the ROI’s contour and then defines the anterior and posterior tips as the two coordinates in the hull that are farthest from one another. This function then bisects the contour across an axis determined by the tips, creates two vectors of equally spaced coordinates for each half of the body, and then calculates the midline as the average x and y position of each ordered pair of contour coordinates.</li>
<li>
<code><a href="../reference/free.ml.ang.html">free.ml.ang()</a></code>: performs the same operations as <code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code>, but, before bisection, refines the tips by finding coordinates that form the vertex of the sharpest angle within end regions of the contour. *<code><a href="../reference/free.ml.ang.html">free.ml.del()</a></code>: estimates the midline coordinates through Delaunay triangulation and Voronoi tessellation using the R package <code>deldir</code>. Invoking functions from the <code>sp</code> and <code>igraph</code> packages, triangulated points that lie within the contour are used to build a distance-weighted minimum spanning tree that expands until the path intersects with the contour. The extrema of the midline path are then indexed as the first and last according to their distance from one of the candidate tips found using a hull as in <code>free.ml.hull</code> and <code>free.ml.ang</code>.</li>
</ul>
<p><code><a href="../reference/free.ml.ang.html">free.ml.ang()</a></code>and <code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code> may be more appropriate for complicated outlines (i.e., those with appendages). <code>free.ml.del</code> tends to produce better results when an ROI has contour regions that overlap (i.e, kinks or snakes back on itself); however, it produces less precise midlines for complicated contours and is slower for high resolution outlines. In the example above, <code><a href="../reference/free.ml.ang.html">free.ml.hull()</a></code> and <code><a href="../reference/free.ml.ang.html">free.ml.del()</a></code> perform equally as well.</p>
<p>Note that reducing the resolution with argument ‘red’ when implementing these functions in <code><a href="../reference/kin.search.html">kin.free()</a></code> may hasten the speed considerably.</p>
<p>To see their different approaches and outcomes, these three functions are run on a smoothed contour retrieved from <code><a href="../reference/kin.search.html">kin.free()</a></code>. Note that the <code>free.ml()</code> functions take a matrix with named x and y columns as input.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.cont</span> <span class="op">&lt;-</span> <span class="va">kin.cel.fr</span><span class="op">$</span><span class="va">cont.sm</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">cel.cont</span>,<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/celcont-1.png" width="700"></p>
<p>Now the three midline functions are run on this contour.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.ml.ang</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/free.ml.ang.html">free.ml.ang</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">cel.cont</span><span class="op">)</span><span class="op">)</span>
<span class="va">cel.ml.hull</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/free.ml.ang.html">free.ml.hull</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">cel.cont</span><span class="op">)</span><span class="op">)</span>
<span class="va">cel.ml.del</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/free.ml.ang.html">free.ml.del</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">cel.cont</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can have a look at the midline retrieved by these three functions plotted over the smoothed contour using <code>ggplot</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cel.ml.ang</span><span class="op">$</span><span class="va">ml</span><span class="op">[</span>,<span class="va">`function`</span><span class="op">:=</span><span class="st">"free.ml.ang()"</span><span class="op">]</span>
<span class="va">cel.ml.hull</span><span class="op">$</span><span class="va">ml</span><span class="op">[</span>,<span class="va">`function`</span><span class="op">:=</span><span class="st">"free.ml.hull()"</span><span class="op">]</span>
<span class="va">cel.ml.del</span><span class="op">$</span><span class="va">ml</span><span class="op">[</span>,<span class="va">`function`</span><span class="op">:=</span><span class="st">"free.ml.del()"</span><span class="op">]</span>

<span class="va">cel.ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">cel.ml.ang</span><span class="op">$</span><span class="va">ml</span>,<span class="va">cel.ml.hull</span><span class="op">$</span><span class="va">ml</span>,<span class="va">cel.ml.del</span><span class="op">$</span><span class="va">ml</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/qplot.html">qplot</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">kin.cel.fr</span><span class="op">$</span><span class="va">cont.sm</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>,x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_point.html">geom_point</a></span><span class="op">(</span>dat<span class="op">=</span><span class="va">cel.ml</span>,<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_continuous.html">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">`function`</span><span class="op">~</span><span class="va">.</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/celmlcomp-1.png" width="700"></p>
<p>In <code><a href="../reference/kin.search.html">kin.free()</a></code>, the position of the anterior of the ROI (i.e., the leading edge) is determined by the displacement of the ROI between the first two frames. Thus, the use of <code><a href="../reference/kin.search.html">kin.free()</a></code> requires the analysis of at least two frames. For analyses of relatively static ROIs in the field (e.g., steadily swimming animals in flumes, etc.), automatically determining the anterior of the ROI may be spurious. In this case, the default automatic determination of the anterior can be overridden by specifying ‘l’, ‘r’, ‘u’, ‘d’ with the argument <code>ant.pos</code>. These values specify that the anterior region of the ROI is leftmost, rightmost, upmost, or downmost in the field, respectively, and assumes that the origin of the pixel field (0,0) is the upper left corner of each frame.</p>
<p>Using <code><a href="../reference/kin.search.html">kin.free()</a></code> in these cases will come at a cost in terms of processing speed due to the more involved midline procedure with the <code>free.ml</code> functions. Therefore, if the ROI is oriented nearly horizontally, <code><a href="../reference/kin.search.html">kin.simple()</a></code> or <code><a href="../reference/kin.search.html">kin.search()</a></code> will produce similar results faster.</p>
<p>To demonstrate the similar results, yet increased processing time, <code><a href="../reference/kin.search.html">kin.simple()</a></code> and <code><a href="../reference/kin.search.html">kin.free()</a></code> are run on an 11-frame video of a swimming pumpkinseed sunfish after image extraction with <code><a href="../reference/vid.to.images2.html">vid.to.images2()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sunfish.vid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/vid"</span>, <span class="st">"sunfish_BCF_red.avi"</span>, package <span class="op">=</span> <span class="st">"trackter"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in dir.create("./sunfish_images"): './sunfish_images' already exists</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vid.to.images2.html">vid.to.images2</a></span><span class="op">(</span>vid.path <span class="op">=</span> <span class="va">sunfish.vid</span>, out.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="va">sunfish.kin.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.simple</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span>,ml.meth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"spline"</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   3.464   0.715   4.473</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="va">sunfish.kin.fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kin.search.html">kin.free</a></span><span class="op">(</span>image.dir <span class="op">=</span> <span class="st">"./sunfish_images"</span>,ant.pos <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'data.table'</code></pre>
<pre><code>## The following objects are masked from 'package:dplyr':
## 
##     between, first, last</code></pre>
<pre><code>##    user  system elapsed 
##   6.467   0.838   7.808</code></pre>
<p>Now the results are plotted for a single frame using <code><a href="../reference/data.overlay.html">data.overlay()</a></code>. First he results from <code><a href="../reference/kin.search.html">kin.simple()</a></code>, then the results fron <code><a href="../reference/kin.search.html">kin.free()</a></code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sunfish.frame1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"./sunfish_images"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">sunfish.frame1</span>,over<span class="op">=</span><span class="va">sunfish.kin.sim</span> <span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">0</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y.sm</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/data.overlay.html">data.overlay</a></span><span class="op">(</span><span class="va">sunfish.frame1</span>,over<span class="op">=</span><span class="va">sunfish.kin.fr</span> <span class="op">$</span><span class="va">midline</span><span class="op">[</span><span class="va">frame</span><span class="op">==</span><span class="fl">0</span>,<span class="fu">.</span><span class="op">(</span><span class="va">x</span>,<span class="va">y.sm</span><span class="op">)</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p><img src="kin_functions_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Despite the increased processing time, using <code><a href="../reference/kin.search.html">kin.free()</a></code> may be an attractive option if the target ROI is static and oriented vertically or toward a corner of the image field.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Kenaley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
