<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Simplified midline tracking over image sequences — kin.simple • trackter</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Simplified midline tracking over image sequences — kin.simple" />
<meta property="og:description" content="Automatically retrieves the midline of a detected ROI based on size. Assumes the ROI of interest is the largest detected and not intersecting the edges of the image frame, conditions often met in kinematic studies. For each ROI of interest, finds the y-value midpoint along the x-value array of the ROI and fits a midline according to a chosen smoothing method (loess or spline). Also outputs the midline amplitude relative to a reference line determined by an anterior section of the ROI and outputs contours ROIs in each frame for subsequent analysis. Supported image formats are jpeg, png, and tiff." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trackter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tutorial.html">tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simplified midline tracking over image sequences</h1>
    
    <div class="hidden name"><code>kin.simple.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Automatically retrieves the midline of a detected ROI based on size. Assumes the ROI of interest is the largest detected and not intersecting the edges of the image frame, conditions often met in kinematic studies. For each ROI of interest, finds the y-value midpoint along the x-value array of the ROI and fits a midline according to a chosen smoothing method (loess or spline). Also outputs the midline amplitude relative to a reference line determined by an anterior section of the ROI and outputs contours ROIs in each frame for subsequent analysis. Supported image formats are jpeg, png, and tiff.</p>
    </div>

    <pre class="usage"><span class='fu'>kin.simple</span><span class='op'>(</span>
  image.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  frames <span class='op'>=</span> <span class='cn'>NULL</span>,
  thr <span class='op'>=</span> <span class='fl'>0.7</span>,
  size.min <span class='op'>=</span> <span class='fl'>0.05</span>,
  ant.per <span class='op'>=</span> <span class='fl'>0.2</span>,
  tips <span class='op'>=</span> <span class='fl'>0.02</span>,
  smoothing <span class='op'>=</span> <span class='st'>"loess"</span>,
  smooth <span class='op'>=</span> <span class='fl'>0.25</span>,
  smooth.points <span class='op'>=</span> <span class='fl'>200</span>,
  save <span class='op'>=</span> <span class='cn'>TRUE</span>,
  out.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot.pml <span class='op'>=</span> <span class='cn'>TRUE</span>,
  image.type <span class='op'>=</span> <span class='st'>"orig"</span>,
  flip <span class='op'>=</span> <span class='cn'>TRUE</span>,
  show.prog <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>image.dir</th>
      <td><p>character, directory containing images to analyze.</p></td>
    </tr>
    <tr>
      <th>frames</th>
      <td><p>numeric, vector indicating which images to process.</p></td>
    </tr>
    <tr>
      <th>thr</th>
      <td><p>numeric or character ('otsu') threshold to determine binary image. See Details.</p></td>
    </tr>
    <tr>
      <th>size.min</th>
      <td><p>numeric, indicating the minimum size of ROIs as a proportion of the pixel field to be considered in analysis. May be useful if smaller unimportant ROIs appear in the frame. Default is 0.05.</p></td>
    </tr>
    <tr>
      <th>ant.per</th>
      <td><p>numeric; left-most proportion of ROI that establishes the horizontal reference for the midline displacement.</p></td>
    </tr>
    <tr>
      <th>tips, </th>
      <td><p>numeric, the proportion the the midline data to use in calculation of the head and tail position.</p></td>
    </tr>
    <tr>
      <th>smoothing</th>
      <td><p>character, the midline smoothing method, either 'loess' or 'spline'.</p></td>
    </tr>
    <tr>
      <th>smooth</th>
      <td><p>numeric; if <code>smoothing</code> is set to 'loess', passed to 'span' parameter of <code><a href='https://rdrr.io/r/stats/loess.html'>loess</a></code>. If <code>smoothing</code> is set to 'spline', passed to 'spar' parameter of <code><a href='https://rdrr.io/r/stats/smooth.spline.html'>smooth.spline</a></code></p></td>
    </tr>
    <tr>
      <th>smooth.points</th>
      <td><p>numeric, number of equally spaced points along the ROI midline on which the smoothed midline is computed.</p></td>
    </tr>
    <tr>
      <th>save</th>
      <td><p>logical, value indicating if images should be outputted with midline and predicted midline based on the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> predictions from <code>ant.per</code>overlaying original or binary images.</p></td>
    </tr>
    <tr>
      <th>out.dir</th>
      <td><p>character, the directory to which outputted images should be saved.</p></td>
    </tr>
    <tr>
      <th>plot.pml</th>
      <td><p>logical, value indicating if outputted images should include the predicted midline (in blue) and the points according to <code>ant.per</code> used to construct the predicted midline (in green).</p></td>
    </tr>
    <tr>
      <th>image.type</th>
      <td><p>character; the type of image to be outputted, either 'orig' or 'bin' representing the original or binary images, respectively. Ignored if 'save=FALSE'.</p></td>
    </tr>
    <tr>
      <th>flip</th>
      <td><p>logical, indicating if binary image should be flipped.</p></td>
    </tr>
    <tr>
      <th>show.prog</th>
      <td><p>logical, indicating if outputted image should be displayed during analysis.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with the following components:</p>
<p><code>kin.dat</code> a data table consisting of frame-by-frame position parameters for the ROI determined by LDA analysis.</p><ul>
<li><p>the frame number</p></li>
<li><p>'x' and 'y': the position of the tail (rightmost or posteriormost)</p></li>
<li><p>'head.x' and 'head.y': the x and y position of the head (leftmost or anteriormost)</p></li>
<li><p>'amp': the amplitude (<code>amp</code>) of the tail relative to the theoretical midline determined by the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> predictions from <code>ant.per</code></p></li>
<li><p>'roi': a character indicating the ROI ranked by size ('a' being the largest)</p></li>
<li><p>'head.pval': p values of the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> fit that describes the position of the head as determined by <code>ant.per</code> (green points in the outputted images/video)</p></li>
</ul>

<p><code>midline</code> A data table containing, for each frame described by <code>frames</code>, the following:</p><ul>
<li><p>'x' and 'y.m': x and y positions of the midline of the ROI
#'</p></li>
<li><p>'y.min' and 'y.max': min and max y positions ROI's contour used in y.m calculation</p></li>
<li><p>'mid.pred': the predicted linear midline based on the points/pixels defined by <code>ant.per</code> (green points in the outputted images/video if 'plot.pml=TRUE')</p></li>
<li><p>'y.pred': midline points fit to a smooth spline or loess model with spar or span equal to <code>smooth</code> (red curve in the outputted images/video)</p></li>
<li><p>'wave.y': midline points 'y.pred' relative to 'mid.pred'</p></li>
<li><p>'roi': a character indicating ROI size ('a' being the largest)</p></li>
</ul>

<p><code>cont</code> A data table containing x and y positions of the contours used to calculate the data in 'kin.dat'. Contains the following:</p><ul>
<li><p>'frame': the frame</p></li>
<li><p>'x' and 'y': the x and y positions of the contours</p></li>
</ul>

<p><code>all.classes</code> A data table containing the following for all ROIs detected:</p><ul>
<li><p>'frame': the frame</p></li>
<li><p>'roi': the name of each ROI found in a frame.</p></li>
<li><p>'size': the size of each ROI</p></li>
</ul>

<p><code>dim</code> the x and y dimensions of the images analyzed</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The algorithm assumes a left-right orientation, i.e., the head of the ROI is positioned left, the tail right. ffmpeg operations or even imageJ can rotate images not in this orientation. The <code>ant.per</code> value therefore establishes the reference line (theoretical straight midline) based on that portion of the head. The midline is calculated as the midpoints between the y extrema for each x position.</p>
<p>If 'save=TRUE', images are saved as binary or the original with a body midline  overlay and, if chosen, with the theoretical midline (based on <code>ant.per</code>).</p>
<p>Thresholding operations can be performed with an arbitrary (user defined) numeric value or with Otsu's method ('thr="otsu"'). The latter chooses a threshold value by minimizing the combined intra-class variance. See <code><a href='https://rdrr.io/pkg/EBImage/man/otsu.html'>otsu</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='kin.search.html'>kin.search</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples">kin.simple,Simplified midline tracking over image sequences,Simplified midline tracking over image sequences — kin.simple,kin.simple.Rd,character(0),kin.simple,character(0),list(title = "Description", contents = "<p>Automatically retrieves the midline of a detected ROI based on size. Assumes the ROI of interest is the largest detected and not intersecting the edges of the image frame, conditions often met in kinematic studies. For each ROI of interest, finds the y-value midpoint along the x-value array of the ROI and fits a midline according to a chosen smoothing method (loess or spline). Also outputs the midline amplitude relative to a reference line determined by an anterior section of the ROI and outputs contours ROIs in each frame for subsequent analysis. Supported image formats are jpeg, png, and tiff.</p>"),list(description = "Automatically retrieves the midline of a detected ROI based on size. Assumes the ROI of interest is the largest detected and not intersecting the edges of the image frame, conditions often met in kinematic studies. For each ROI of interest, finds the y-value midpoint along the x-value array of the ROI and fits a midline according to a chosen smoothing method (loess or spline). Also outputs the midline amplitude relative to a reference line determined by an anterior section of the ROI and outputs contours ROIs in each frame for subsequent analysis. Supported image formats are jpeg, png, and tiff."),<span class='fu'>kin.simple</span><span class='op'>(</span>
  image.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  frames <span class='op'>=</span> <span class='cn'>NULL</span>,
  thr <span class='op'>=</span> <span class='fl'>0.7</span>,
  size.min <span class='op'>=</span> <span class='fl'>0.05</span>,
  ant.per <span class='op'>=</span> <span class='fl'>0.2</span>,
  tips <span class='op'>=</span> <span class='fl'>0.02</span>,
  smoothing <span class='op'>=</span> <span class='st'>"loess"</span>,
  smooth <span class='op'>=</span> <span class='fl'>0.25</span>,
  smooth.points <span class='op'>=</span> <span class='fl'>200</span>,
  save <span class='op'>=</span> <span class='cn'>TRUE</span>,
  out.dir <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot.pml <span class='op'>=</span> <span class='cn'>TRUE</span>,
  image.type <span class='op'>=</span> <span class='st'>"orig"</span>,
  flip <span class='op'>=</span> <span class='cn'>TRUE</span>,
  show.prog <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>,list(list(name = "image.dir", description = "<p>character, directory containing images to analyze.</p>"), list(name = "frames", description = "<p>numeric, vector indicating which images to process.</p>"), list(name = "thr", description = "<p>numeric or character ('otsu') threshold to determine binary image. See Details.</p>"), list(name = "size.min", description = "<p>numeric, indicating the minimum size of ROIs as a proportion of the pixel field to be considered in analysis. May be useful if smaller unimportant ROIs appear in the frame. Default is 0.05.</p>"), 
    list(name = "ant.per", description = "<p>numeric; left-most proportion of ROI that establishes the horizontal reference for the midline displacement.</p>"), list(name = "tips, ", description = "<p>numeric, the proportion the the midline data to use in calculation of the head and tail position.</p>"), list(name = "smoothing", description = "<p>character, the midline smoothing method, either 'loess' or 'spline'.</p>"), list(name = "smooth", description = "<p>numeric; if <code>smoothing</code> is set to 'loess', passed to 'span' parameter of <code><a href='https://rdrr.io/r/stats/loess.html'>loess</a></code>. If <code>smoothing</code> is set to 'spline', passed to 'spar' parameter of <code><a href='https://rdrr.io/r/stats/smooth.spline.html'>smooth.spline</a></code></p>"), 
    list(name = "smooth.points", description = "<p>numeric, number of equally spaced points along the ROI midline on which the smoothed midline is computed.</p>"), list(name = "save", description = "<p>logical, value indicating if images should be outputted with midline and predicted midline based on the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> predictions from <code>ant.per</code>overlaying original or binary images.</p>"), list(name = "out.dir", description = "<p>character, the directory to which outputted images should be saved.</p>"), 
    list(name = "plot.pml", description = "<p>logical, value indicating if outputted images should include the predicted midline (in blue) and the points according to <code>ant.per</code> used to construct the predicted midline (in green).</p>"), list(name = "image.type", description = "<p>character; the type of image to be outputted, either 'orig' or 'bin' representing the original or binary images, respectively. Ignored if 'save=FALSE'.</p>"), list(name = "flip", description = "<p>logical, indicating if binary image should be flipped.</p>"), 
    list(name = "show.prog", description = "<p>logical, indicating if outputted image should be displayed during analysis.</p>")),TRUE,<div class='input'><span class='co'>#### plot caudal amplitude and produce a classic midline waveform plot of swimming fish  </span>
<span class='co'>##A very long example.</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>  

<span class='co'>#download example images and place in 'example' subdirectory  </span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='st'>"https://github.com/ckenaley/exampledata/blob/master/example.zip?raw=true"</span>  

<span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>f</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/temp.zip"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/unzip.html'>unzip</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/temp.zip"</span><span class='op'>)</span>, exdir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>  
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/temp.zip"</span><span class='op'>)</span><span class='op'>)</span>  

<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/processed_images"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>kin</span> <span class='op'>&lt;-</span> <span class='fu'>kin.simple</span><span class='op'>(</span>image.dir <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/example"</span><span class='op'>)</span>,  
      smoothing <span class='op'>=</span> <span class='st'>"loess"</span>,frames<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span>,
      out.dir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/processed_images"</span><span class='op'>)</span>,
      show.prog <span class='op'>=</span> <span class='cn'>FALSE</span>,thr <span class='op'>=</span> <span class='st'>"otsu"</span>,  
      image.type<span class='op'>=</span><span class='st'>"bin"</span>,smooth<span class='op'>=</span><span class='fl'>0.4</span><span class='op'>)</span>  

<span class='co'>#plot instantaneous amplitude of tail (last/rightmost point) over frames   </span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>dat<span class='op'>=</span><span class='va'>kin</span><span class='op'>$</span><span class='va'>kin.dat</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>frame</span>,y<span class='op'>=</span><span class='va'>amp</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='fl'>15</span><span class='op'>)</span>  
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>  
  
<span class='co'># midline plot  </span>
<span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='va'>kin</span><span class='op'>$</span><span class='va'>midline</span>  
<span class='co'>#leftmost x starts at 0  </span>
<span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='va'>ml</span><span class='op'>[</span>,<span class='va'>x2</span><span class='op'>:=</span><span class='va'>x</span><span class='op'>-</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,by<span class='op'>=</span><span class='va'>frame</span><span class='op'>]</span>  

<span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>ml</span>,<span class='va'>kin</span><span class='op'>$</span><span class='va'>kin.dat</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>frame</span>,<span class='va'>amp</span><span class='op'>)</span><span class='op'>]</span>,by<span class='op'>=</span><span class='st'>"frame"</span><span class='op'>)</span> <span class='co'>#merge these  </span>

<span class='va'>pal</span> <span class='op'>&lt;-</span> <span class='fu'>wes_palette</span><span class='op'>(</span><span class='st'>"Zissou1"</span>, <span class='fl'>100</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span> <span class='co'>#"Zissou" color palette</span>

<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>dat<span class='op'>=</span><span class='va'>ml</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x2</span>,y<span class='op'>=</span><span class='va'>wave.y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='fl'>15</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_color_gradientn</a></span><span class='op'>(</span>colours <span class='op'>=</span> <span class='va'>pal</span><span class='op'>)</span>  
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group<span class='op'>=</span><span class='va'>frame</span>,color<span class='op'>=</span><span class='va'>amp</span><span class='op'>)</span>,stat<span class='op'>=</span><span class='st'>"smooth"</span>,method <span class='op'>=</span> <span class='st'>"loess"</span>, size <span class='op'>=</span> <span class='fl'>1.5</span><span class='op'>)</span>  
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>  
  
<span class='co'>#Make a video of processed frames  </span>

<span class='fu'><a href='images.to.video2.html'>images.to.video2</a></span><span class='op'>(</span>image.dir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/processed_images"</span><span class='op'>)</span>,  
vid.name<span class='op'>=</span><span class='st'>"trout_test"</span>,out.dir<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,frame.rate<span class='op'>=</span><span class='fl'>5</span>,qual<span class='op'>=</span><span class='fl'>100</span>,raw<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>  
<span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>,<span class='st'>"/trout_test_red.mp4"</span><span class='op'>)</span><span class='op'>)</span>

<span class='op'>}</span>

<span class='co'>## A very short example.</span>

<span class='co'>#retrieve image </span>
<span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>readImage</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/img"</span>, <span class='st'>"sunfish_BCF.jpg"</span>, package <span class='op'>=</span> <span class='st'>"trackter"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>#create directory and write image to it</span>
<span class='va'>t</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>writeImage</a></span><span class='op'>(</span><span class='va'>i</span>,<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images/sunfish001.jpg"</span><span class='op'>)</span>,type <span class='op'>=</span> <span class='st'>"jpeg"</span><span class='op'>)</span>

<span class='co'>#run kin.search and save output image to directory</span>
<span class='va'>kin.i</span><span class='op'>&lt;-</span> <span class='fu'>kin.simple</span><span class='op'>(</span>image.dir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span>,save <span class='op'>=</span> <span class='cn'>TRUE</span>,out.dir <span class='op'>=</span> <span class='va'>t</span><span class='op'>)</span>

<span class='co'>#plot midline</span>
<span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>kin.i</span><span class='op'>$</span><span class='va'>midline</span>,<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>wave.y</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='kin.simple-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='va'>i2</span> <span class='op'>&lt;-</span> <span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/io.html'>readImage</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/sunfish001_000.jpg"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>EBImage</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EBImage/man/display.html'>display</a></span><span class='op'>(</span><span class='va'>i2</span>,method<span class='op'>=</span><span class='st'>"raster"</span><span class='op'>)</span>
</div><div class='img'><img src='kin.simple-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>#clean up</span>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>t</span>,<span class='st'>"/images"</span><span class='op'>)</span>,recursive<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
</div>,list(list(title = "Value", contents = "<p>A list with the following components:</p>\n<p><code>kin.dat</code> a data table consisting of frame-by-frame position parameters for the ROI determined by LDA analysis.</p><ul>\n<li><p>the frame number</p></li>\n<li><p>'x' and 'y': the position of the tail (rightmost or posteriormost)</p></li>\n<li><p>'head.x' and 'head.y': the x and y position of the head (leftmost or anteriormost)</p></li>\n<li><p>'amp': the amplitude (<code>amp</code>) of the tail relative to the theoretical midline determined by the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> predictions from <code>ant.per</code></p></li>\n<li><p>'roi': a character indicating the ROI ranked by size ('a' being the largest)</p></li>\n<li><p>'head.pval': p values of the <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> fit that describes the position of the head as determined by <code>ant.per</code> (green points in the outputted images/video)</p></li>\n</ul>\n\n<p><code>midline</code> A data table containing, for each frame described by <code>frames</code>, the following:</p><ul>\n<li><p>'x' and 'y.m': x and y positions of the midline of the ROI\n#'</p></li>\n<li><p>'y.min' and 'y.max': min and max y positions ROI's contour used in y.m calculation</p></li>\n<li><p>'mid.pred': the predicted linear midline based on the points/pixels defined by <code>ant.per</code> (green points in the outputted images/video if 'plot.pml=TRUE')</p></li>\n<li><p>'y.pred': midline points fit to a smooth spline or loess model with spar or span equal to <code>smooth</code> (red curve in the outputted images/video)</p></li>\n<li><p>'wave.y': midline points 'y.pred' relative to 'mid.pred'</p></li>\n<li><p>'roi': a character indicating ROI size ('a' being the largest)</p></li>\n</ul>\n\n<p><code>cont</code> A data table containing x and y positions of the contours used to calculate the data in 'kin.dat'. Contains the following:</p><ul>\n<li><p>'frame': the frame</p></li>\n<li><p>'x' and 'y': the x and y positions of the contours</p></li>\n</ul>\n\n<p><code>all.classes</code> A data table containing the following for all ROIs detected:</p><ul>\n<li><p>'frame': the frame</p></li>\n<li><p>'roi': the name of each ROI found in a frame.</p></li>\n<li><p>'size': the size of each ROI</p></li>\n</ul>\n\n<p><code>dim</code> the x and y dimensions of the images analyzed</p>", 
    slug = "value"), list(title = "Details", contents = "<p>The algorithm assumes a left-right orientation, i.e., the head of the ROI is positioned left, the tail right. ffmpeg operations or even imageJ can rotate images not in this orientation. The <code>ant.per</code> value therefore establishes the reference line (theoretical straight midline) based on that portion of the head. The midline is calculated as the midpoints between the y extrema for each x position.</p>\n<p>If 'save=TRUE', images are saved as binary or the original with a body midline  overlay and, if chosen, with the theoretical midline (based on <code>ant.per</code>).</p>\n<p>Thresholding operations can be performed with an arbitrary (user defined) numeric value or with Otsu's method ('thr=\"otsu\"'). The latter chooses a threshold value by minimizing the combined intra-class variance. See <code><a href='https://rdrr.io/pkg/EBImage/man/otsu.html'>otsu</a></code>.</p>", 
    slug = "details"), list(title = "See also", contents = "<div class='dont-index'><p><code><a href='kin.search.html'>kin.search</a></code></p></div>", slug = "see-also")),2021,list(name = "trackter", version = "0.1.1", authors = "Christopher Kenaley"),list(destination = "dev", mode = "release", version_label = "default", version_tooltip = "Released version", in_dev = FALSE),list(root = "../", title = "trackter"),list(),list(type = "default", left = "<li>\n  <a href=\"../index.html\">\n    <span class=\"fas fa-home fa-lg\"></span>\n     \n  </a>\n</li>\n<li>\n  <a href=\"../reference/index.html\">Reference</a>\n</li>\n<li class=\"dropdown\">\n  <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" role=\"button\" aria-expanded=\"false\">\n    Articles\n     \n    <span class=\"caret\"></span>\n  </a>\n  <ul class=\"dropdown-menu\" role=\"menu\">\n    <li>\n      <a href=\"../articles/tutorial.html\">tutorial</a>\n    </li>\n  </ul>\n</li>\n<li>\n  <a href=\"../news/index.html\">Changelog</a>\n</li>", 
    right = ""),list(bootswatch = "cerulean", .present = TRUE),list(version = "1.6.1"),FALSE</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christopher Kenaley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


